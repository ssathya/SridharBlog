<!doctype html><html lang=en><head><title>Using aws systems manager in a docker image | Sridhar's Blog!</title><meta charset=utf-8><meta name=viewport content="width=device-width,initial-scale=1,maximum-scale=1,user-scalable=no"><meta http-equiv=X-UA-Compatible content="IE=edge"><meta name=keywords content="Sridhar's Blog!"><meta property="og:locale" content='en_US'><meta property="og:type" content="article"><meta property="og:title" content="Using AWS Systems Manager in a docker image"><meta property="og:description" content="I had issues using AWS Systems Manager in a docker container; I wanted to pass my login credentials via environment variables. Systems Manager does not use"><meta property="og:url" content="https://ssathya.github.io/SridharBlog/posts/aws-systems-manager/"><meta property="og:image" content="images/%!s(<nil>)"><link rel=canonical href=https://ssathya.github.io/SridharBlog/posts/aws-systems-manager/><link rel=apple-touch-icon sizes=180x180 href=https://ssathya.github.io/SridharBlog/apple-touch-icon.png><link rel=icon type=image/png sizes=32x32 href=https://ssathya.github.io/SridharBlog/favicon-32x32.png><link rel=icon type=image/png sizes=16x16 href=https://ssathya.github.io/SridharBlog/favicon-16x16.png><link rel=manifest href=https://ssathya.github.io/SridharBlog/site.webmanifest><link rel=stylesheet href=https://ssathya.github.io/SridharBlog/css/styles.648e60c6d86809f863ae1346848574b9c685732794e7851c7d3e557de9ddd293bc1c209f963d5041785c2fd4268470bdfde453a99f550b655d1b4f825eed4682.css integrity="sha512-ZI5gxthoCfhjrhNGhIV0ucaFcyeU54UcfT5Vfend0pO8HCCflj1QQXhcL9QmhHC9/eRTqZ9VC2VdG0+CXu1Ggg=="></head><body><div class=nav-drop><div class=nav-body><div class=nav-close></div><div class=color_mode><label for=mode>Toggle Dark Mode</label>
<input type=checkbox class=color_choice id=mode></div></div></div><header class=nav><nav class=nav-menu><a href=https://ssathya.github.io/SridharBlog/ class="nav-brand nav_item">Sridhar's Blog!</a><div class=nav_bar-wrap><div class=nav_bar></div></div></nav></header><main><div class="wrap mt post"><div><p class=post_date>15. March 2025</p><h1 class=post_title>Using AWS Systems Manager in a docker image</h1><div class=post_body><div class=post_inner><p>I had issues using AWS Systems Manager in a docker container; I wanted to pass my login credentials via environment variables. Systems Manager does not use environment variables like AWS_ACCESS_KEY_ID, AWS_SECRET_ACCESS_KEY, etc. and I didn&rsquo;t see any examples of how people use Systems Manager within a docker image.</p><p>This is the way I solved it and yes it works!</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-cs data-lang=cs><span style=display:flex><span><span style=color:#66d9ef>using</span> Amazon.Extensions.NETCore.Setup;
</span></span><span style=display:flex><span><span style=color:#66d9ef>using</span> Amazon.Runtime;
</span></span><span style=display:flex><span><span style=color:#66d9ef>using</span> Microsoft.Extensions.Configuration;
</span></span><span style=display:flex><span><span style=color:#66d9ef>using</span> Microsoft.Extensions.DependencyInjection;
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>namespace</span> CloudConsole.Services;
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>public</span> <span style=color:#66d9ef>static</span> <span style=color:#66d9ef>class</span> <span style=color:#a6e22e>ServiceBuilder</span>
</span></span><span style=display:flex><span>{
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>private</span> <span style=color:#66d9ef>static</span> IConfiguration? Configuration;
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>internal</span> <span style=color:#66d9ef>static</span> IServiceCollection ConfigureServices(<span style=color:#66d9ef>string</span> applicationName)
</span></span><span style=display:flex><span>    {
</span></span><span style=display:flex><span>        IServiceCollection services = <span style=color:#66d9ef>new</span> ServiceCollection();
</span></span><span style=display:flex><span>        Configuration = BuildConfiguration(applicationName);
</span></span><span style=display:flex><span>        services.AddSingleton(Configuration);
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>return</span> services;
</span></span><span style=display:flex><span>    }
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>private</span> <span style=color:#66d9ef>static</span> IConfiguration BuildConfiguration(<span style=color:#66d9ef>string</span> applicationName)
</span></span><span style=display:flex><span>    {
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>var</span> allEnvVariables = Environment.GetEnvironmentVariables();
</span></span><span style=display:flex><span>        <span style=color:#75715e>//var region = allEnvVariables[&#34;AWS_DEFAULT_REGION&#34;]?.ToString() ?? string.Empty;</span>
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>var</span> accessKey = allEnvVariables[<span style=color:#e6db74>&#34;AWS_ACCESS_KEY_ID&#34;</span>]?.ToString() ?? <span style=color:#66d9ef>string</span>.Empty;
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>var</span> secretKey = allEnvVariables[<span style=color:#e6db74>&#34;AWS_SECRET_ACCESS_KEY&#34;</span>]?.ToString() ?? <span style=color:#66d9ef>string</span>.Empty;
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>var</span> awsCredentials = <span style=color:#66d9ef>new</span> BasicAWSCredentials(accessKey, secretKey);
</span></span><span style=display:flex><span>        AWSOptions aWSOptions = <span style=color:#66d9ef>new</span>()
</span></span><span style=display:flex><span>        {
</span></span><span style=display:flex><span>            Region = Amazon.RegionEndpoint.USEast1,
</span></span><span style=display:flex><span>            Credentials = awsCredentials
</span></span><span style=display:flex><span>        };
</span></span><span style=display:flex><span>        IConfigurationBuilder builder = <span style=color:#66d9ef>new</span> ConfigurationBuilder();
</span></span><span style=display:flex><span>        builder.SetBasePath(Directory.GetCurrentDirectory())
</span></span><span style=display:flex><span>            .AddJsonFile(<span style=color:#e6db74>&#34;appsettings.json&#34;</span>, optional: <span style=color:#66d9ef>true</span>, reloadOnChange: <span style=color:#66d9ef>true</span>)
</span></span><span style=display:flex><span>            .AddJsonFile(<span style=color:#e6db74>$&#34;appsettings.{Environment.GetEnvironmentVariable(&#34;</span>ASPNETCORE_ENVIRONMENT<span style=color:#e6db74>&#34;) ?? &#34;</span>Production<span style=color:#e6db74>&#34;}.json&#34;</span>
</span></span><span style=display:flex><span>                , optional: <span style=color:#66d9ef>true</span>, reloadOnChange: <span style=color:#66d9ef>true</span>)
</span></span><span style=display:flex><span>            .AddEnvironmentVariables()
</span></span><span style=display:flex><span>            .AddSystemsManager(<span style=color:#e6db74>@&#34;/&#34;</span> + applicationName + <span style=color:#e6db74>@&#34;/&#34;</span>, aWSOptions, TimeSpan.FromMinutes(<span style=color:#ae81ff>5</span>))
</span></span><span style=display:flex><span>            .AddSystemsManager(<span style=color:#e6db74>&#34;&#34;&#34;/PortfolioManager/&#34;&#34;&#34;</span>, aWSOptions);
</span></span><span style=display:flex><span>        Configuration = builder.Build();
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>return</span> Configuration;
</span></span><span style=display:flex><span>    }
</span></span><span style=display:flex><span>}
</span></span></code></pre></div><p>Create an AWSOptions instance and use this instance when you call AddSystemsManager.</p><p>And when I run my image I issue the following command:</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-sh data-lang=sh><span style=display:flex><span>docker run --name test_container1 -e AWS_ACCESS_KEY_ID<span style=color:#f92672>=</span>AccessKey -e AWS_SECRET_ACCESS_KEY<span style=color:#f92672>=</span>SecretKey test_image3
</span></span></code></pre></div></div><div class="post_extra mb-2"><div class=copy data-before="Share Story" data-after="Link Copied"><svg class="icon"><use xlink:href="#copy"/></svg></div></div><div></div></div></div><a href=https://ssathya.github.io/SridharBlog/ class=post_nav><span class=post_next>Latest Posts
<svg class="icon icon_scale"><use xlink:href="#double-arrow"/></svg></span></a></div></main><footer class="footer wrap pale"><p>&copy;&nbsp;<span class=year></span>&nbsp;Sridhar's Blog!</p><p class="attribution upcase">Designed by <a href='<no value>' target=_blank title='Linkedin Profile' rel=nonopener><no value></a></p></footer><script src=https://ssathya.github.io/SridharBlog/js/index.min.37437af50776941f9afce75ecfefd228d0ee6ceb0ad33ff35a9fea22b0a7236be8e38a9ff1666ad540d25dd37bc569705c5cceb13f7cd57ccbf3678201c43771.js></script><svg width="0" height="0" class="hidden"><symbol xmlns="http://www.w3.org/2000/svg" viewBox="0 0 699.428 699.428" id="copy"><path d="M502.714.0H240.428C194.178.0 153 42.425 153 87.429l-25.267.59c-46.228.0-84.019 41.834-84.019 86.838V612c0 45.004 41.179 87.428 87.429 87.428H459c46.249.0 87.428-42.424 87.428-87.428h21.857c46.25.0 87.429-42.424 87.429-87.428v-349.19L502.714.0zM459 655.715H131.143c-22.95.0-43.714-21.441-43.714-43.715V174.857c0-22.272 18.688-42.993 41.638-42.993l23.933-.721v393.429C153 569.576 194.178 612 240.428 612h262.286c0 22.273-20.765 43.715-43.714 43.715zm153-131.143c0 22.271-20.765 43.713-43.715 43.713H240.428c-22.95.0-43.714-21.441-43.714-43.713V87.429c0-22.272 20.764-43.714 43.714-43.714H459c-.351 50.337.0 87.975.0 87.975.0 45.419 40.872 86.882 87.428 86.882H612v306zm-65.572-349.715c-23.277.0-43.714-42.293-43.714-64.981V44.348L612 174.857h-65.572zm-43.714 131.537H306c-12.065.0-21.857 9.77-21.857 21.835s9.792 21.835 21.857 21.835h196.714c12.065.0 21.857-9.771 21.857-21.835.0-12.065-9.792-21.835-21.857-21.835zm0 109.176H306c-12.065.0-21.857 9.77-21.857 21.834.0 12.066 9.792 21.836 21.857 21.836h196.714c12.065.0 21.857-9.77 21.857-21.836.0-12.064-9.792-21.834-21.857-21.834z"/></symbol><symbol viewBox="0 0 53 42" xmlns="http://www.w3.org/2000/svg" id="double-arrow"><path d="M.595 39.653a1.318 1.318.0 010-1.864L16.55 21.833a1.318 1.318.0 000-1.863L.595 4.014a1.318 1.318.0 010-1.863L2.125.62a1.318 1.318.0 011.864.0l19.35 19.349a1.318 1.318.0 010 1.863l-19.35 19.35a1.318 1.318.0 01-1.863.0zm29 0a1.318 1.318.0 010-1.864L45.55 21.833a1.318 1.318.0 000-1.863L29.595 4.014a1.318 1.318.0 010-1.863l1.53-1.53a1.318 1.318.0 011.864.0l19.35 19.349a1.318 1.318.0 010 1.863l-19.35 19.35a1.318 1.318.0 01-1.863.0z"/></symbol></svg></body></html>