<!doctype html><html lang=en><head><title>Semantic kernel rag | Sridhar's Blog!</title><meta charset=utf-8><meta name=viewport content="width=device-width,initial-scale=1,maximum-scale=1,user-scalable=no"><meta http-equiv=X-UA-Compatible content="IE=edge"><meta name=keywords content="Sridhar's Blog!"><meta property="og:locale" content='en_US'><meta property="og:type" content="article"><meta property="og:title" content="SemanticKernelRag"><meta property="og:description" content="Okay, let&rsquo;s break down how to use Semantic Kernel with Retrieval Augmented Generation (RAG) in a Blazor application. It can be a bit tricky to get all the"><meta property="og:url" content="https://ssathya.github.io/SridharBlog/posts/semantickernelrag/"><meta property="og:image" content="images/%!s(<nil>)"><link rel=canonical href=https://ssathya.github.io/SridharBlog/posts/semantickernelrag/><link rel=apple-touch-icon sizes=180x180 href=https://ssathya.github.io/SridharBlog/apple-touch-icon.png><link rel=icon type=image/png sizes=32x32 href=https://ssathya.github.io/SridharBlog/favicon-32x32.png><link rel=icon type=image/png sizes=16x16 href=https://ssathya.github.io/SridharBlog/favicon-16x16.png><link rel=manifest href=https://ssathya.github.io/SridharBlog/site.webmanifest><link rel=stylesheet href=https://ssathya.github.io/SridharBlog/css/styles.648e60c6d86809f863ae1346848574b9c685732794e7851c7d3e557de9ddd293bc1c209f963d5041785c2fd4268470bdfde453a99f550b655d1b4f825eed4682.css integrity="sha512-ZI5gxthoCfhjrhNGhIV0ucaFcyeU54UcfT5Vfend0pO8HCCflj1QQXhcL9QmhHC9/eRTqZ9VC2VdG0+CXu1Ggg=="></head><body><div class=nav-drop><div class=nav-body><div class=nav-close></div><div class=color_mode><label for=mode>Toggle Dark Mode</label>
<input type=checkbox class=color_choice id=mode></div></div></div><header class=nav><nav class=nav-menu><a href=https://ssathya.github.io/SridharBlog/ class="nav-brand nav_item">Sridhar's Blog!</a><div class=nav_bar-wrap><div class=nav_bar></div></div></nav></header><main><div class="wrap mt post"><div><p class=post_date>15. March 2025</p><h1 class=post_title>SemanticKernelRag</h1><div class=post_body><div class=post_inner><p>Okay, let&rsquo;s break down how to use Semantic Kernel with Retrieval Augmented Generation (RAG) in a Blazor application. It can be a bit tricky to get all the pieces working together, so we&rsquo;ll go step by step.</p><p><strong>Understanding the Core Concepts</strong></p><ol><li><strong>Semantic Kernel:</strong> This is a framework that helps you build intelligent applications by integrating Large Language Models (LLMs) like OpenAI, Azure OpenAI, etc. It provides abstractions for things like plugins, memory, and planners.</li><li><strong>RAG (Retrieval Augmented Generation):</strong> This approach improves LLM responses by first retrieving relevant information from a data source (like a vector database) and then using that information as context when generating the final output. This helps the LLM ground its responses in factual data and reduce hallucinations.</li><li><strong>Blazor:</strong> This is a framework for building interactive web UIs with C# instead of JavaScript. We&rsquo;ll use it to create the front-end for your RAG-powered application.</li></ol><p><strong>High-Level Steps</strong></p><p>Here&rsquo;s a general outline of what we&rsquo;ll need to do:</p><ol><li><strong>Set up your environment:</strong> Install the necessary NuGet packages and configure your API keys.</li><li><strong>Prepare your data source:</strong> Choose a vector database (or similar) and index your data.</li><li><strong>Create Semantic Kernel components:</strong> Build your skills (plugins), memory, and kernel.</li><li><strong>Develop your Blazor UI:</strong> Create a simple interface for users to ask questions.</li><li><strong>Connect Semantic Kernel with Blazor:</strong> Send user input to the kernel, get the RAG-enhanced response, and display it in the UI.</li></ol><p><strong>Let&rsquo;s Get Started with the Code</strong></p><p>I&rsquo;ll provide code snippets with explanations and comments. This will be for a simple Blazor Server app for demonstration purposes.</p><p><strong>1. Setting up your Environment</strong></p><ul><li><strong>Create a New Blazor Server Project:</strong><ul><li>In Visual Studio or using the .NET CLI:<div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>dotnet new blazorserver -o MyRAGApp
</span></span><span style=display:flex><span>cd MyRAGApp
</span></span></code></pre></div></li></ul></li><li><strong>Install NuGet Packages:</strong><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>dotnet add package Microsoft.SemanticKernel
</span></span><span style=display:flex><span>dotnet add package Microsoft.SemanticKernel.Connectors.Memory.Qdrant
</span></span><span style=display:flex><span>dotnet add package Microsoft.SemanticKernel.Connectors.OpenAI
</span></span></code></pre></div>(Choose <code>Qdrant</code> or a memory connector of your preference)<ul><li>Make sure you have <code>System.Text.Json</code> package included as well.</li></ul></li></ul><p><strong>2. Configure App Settings (appsettings.json)</strong></p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-json data-lang=json><span style=display:flex><span>{
</span></span><span style=display:flex><span>  <span style=color:#f92672>&#34;Logging&#34;</span>: {
</span></span><span style=display:flex><span>    <span style=color:#f92672>&#34;LogLevel&#34;</span>: {
</span></span><span style=display:flex><span>      <span style=color:#f92672>&#34;Default&#34;</span>: <span style=color:#e6db74>&#34;Information&#34;</span>,
</span></span><span style=display:flex><span>      <span style=color:#f92672>&#34;Microsoft.AspNetCore&#34;</span>: <span style=color:#e6db74>&#34;Warning&#34;</span>
</span></span><span style=display:flex><span>    }
</span></span><span style=display:flex><span>  },
</span></span><span style=display:flex><span>  <span style=color:#f92672>&#34;AllowedHosts&#34;</span>: <span style=color:#e6db74>&#34;*&#34;</span>,
</span></span><span style=display:flex><span>    <span style=color:#f92672>&#34;SemanticKernel&#34;</span>: {
</span></span><span style=display:flex><span>        <span style=color:#f92672>&#34;OpenAI&#34;</span>: {
</span></span><span style=display:flex><span>            <span style=color:#f92672>&#34;ApiKey&#34;</span>: <span style=color:#e6db74>&#34;YOUR_OPENAI_API_KEY&#34;</span>,
</span></span><span style=display:flex><span>            <span style=color:#f92672>&#34;OrgId&#34;</span>: <span style=color:#e6db74>&#34;YOUR_OPTIONAL_OPENAI_ORG_ID&#34;</span>,
</span></span><span style=display:flex><span>            <span style=color:#f92672>&#34;ModelId&#34;</span>: <span style=color:#e6db74>&#34;gpt-3.5-turbo&#34;</span>,
</span></span><span style=display:flex><span>            <span style=color:#f92672>&#34;EmbeddingModelId&#34;</span>: <span style=color:#e6db74>&#34;text-embedding-ada-002&#34;</span>
</span></span><span style=display:flex><span>        },
</span></span><span style=display:flex><span>        <span style=color:#f92672>&#34;Qdrant&#34;</span>:{
</span></span><span style=display:flex><span>            <span style=color:#f92672>&#34;Endpoint&#34;</span>:<span style=color:#e6db74>&#34;http://localhost:6333&#34;</span>,
</span></span><span style=display:flex><span>            <span style=color:#f92672>&#34;VectorSize&#34;</span>:<span style=color:#ae81ff>1536</span>,
</span></span><span style=display:flex><span>            <span style=color:#f92672>&#34;CollectionName&#34;</span>:<span style=color:#e6db74>&#34;ragcollection&#34;</span>
</span></span><span style=display:flex><span>        }
</span></span><span style=display:flex><span>    }
</span></span><span style=display:flex><span>}
</span></span></code></pre></div><ul><li>Replace the placeholder with the api key of your preferred LLM API, e.g., OpenAI. Make sure you also replace the placeholder with the correct values of your memory vector database.</li></ul><p><strong>3. Create Data Loader (optional)</strong></p><ul><li>For simplicity, let&rsquo;s assume you have a simple text file of data to be indexed, say <code>knowledge_base.txt</code>.</li><li><strong>Create a DataLoader service (<code>Services/DataLoader.cs</code>):</strong></li></ul><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-csharp data-lang=csharp><span style=display:flex><span><span style=color:#66d9ef>using</span> System.Text;
</span></span><span style=display:flex><span><span style=color:#66d9ef>using</span> Microsoft.SemanticKernel.Memory;
</span></span><span style=display:flex><span><span style=color:#66d9ef>using</span> Microsoft.Extensions.Options;
</span></span><span style=display:flex><span><span style=color:#66d9ef>using</span> Microsoft.SemanticKernel;
</span></span><span style=display:flex><span><span style=color:#66d9ef>using</span> Microsoft.SemanticKernel.Embeddings;
</span></span><span style=display:flex><span><span style=color:#66d9ef>using</span> Microsoft.SemanticKernel.Connectors.Memory.Qdrant;
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>namespace</span> MyRAGApp.Services
</span></span><span style=display:flex><span>{
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>public</span> <span style=color:#66d9ef>class</span> <span style=color:#a6e22e>DataLoader</span>
</span></span><span style=display:flex><span>    {
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>private</span> <span style=color:#66d9ef>readonly</span> IOptions&lt;SemanticKernelOptions&gt; _options;
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>private</span> <span style=color:#66d9ef>readonly</span> ILogger&lt;DataLoader&gt; _logger;
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>private</span> <span style=color:#66d9ef>readonly</span> ITextEmbeddingGeneration _textEmbeddingGeneration;
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>public</span> DataLoader(
</span></span><span style=display:flex><span>            IOptions&lt;SemanticKernelOptions&gt; options,
</span></span><span style=display:flex><span>            ILogger&lt;DataLoader&gt; logger,
</span></span><span style=display:flex><span>            ITextEmbeddingGeneration textEmbeddingGeneration
</span></span><span style=display:flex><span>        )
</span></span><span style=display:flex><span>        {
</span></span><span style=display:flex><span>            _options = options;
</span></span><span style=display:flex><span>            _logger = logger;
</span></span><span style=display:flex><span>            _textEmbeddingGeneration = textEmbeddingGeneration;
</span></span><span style=display:flex><span>        }
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>public</span> <span style=color:#66d9ef>async</span> Task LoadKnowledge(<span style=color:#66d9ef>string</span> filePath, IKernel kernel)
</span></span><span style=display:flex><span>        {
</span></span><span style=display:flex><span>            <span style=color:#66d9ef>try</span>
</span></span><span style=display:flex><span>            {
</span></span><span style=display:flex><span>                <span style=color:#75715e>// Read content from text file</span>
</span></span><span style=display:flex><span>                <span style=color:#66d9ef>var</span> content = <span style=color:#66d9ef>await</span> File.ReadAllTextAsync(filePath, Encoding.UTF8);
</span></span><span style=display:flex><span>                <span style=color:#66d9ef>var</span> lines = content.Split(Environment.NewLine, StringSplitOptions.RemoveEmptyEntries);
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>                <span style=color:#66d9ef>var</span> memoryStore = GetMemoryStore();
</span></span><span style=display:flex><span>                <span style=color:#66d9ef>if</span>(memoryStore != <span style=color:#66d9ef>null</span>)
</span></span><span style=display:flex><span>                {
</span></span><span style=display:flex><span>                    <span style=color:#66d9ef>foreach</span> (<span style=color:#66d9ef>var</span> line <span style=color:#66d9ef>in</span> lines)
</span></span><span style=display:flex><span>                    {
</span></span><span style=display:flex><span>                        <span style=color:#66d9ef>var</span> id = Guid.NewGuid().ToString();
</span></span><span style=display:flex><span>                        <span style=color:#66d9ef>await</span> kernel.Memory.SaveInformationAsync(_options.Value.Qdrant.CollectionName, line, id, line, <span style=color:#66d9ef>null</span>, _textEmbeddingGeneration);
</span></span><span style=display:flex><span>                    }
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>                    _logger.LogInformation(<span style=color:#e6db74>&#34;Knowledge base loaded successfully&#34;</span>);
</span></span><span style=display:flex><span>                } <span style=color:#66d9ef>else</span>
</span></span><span style=display:flex><span>                {
</span></span><span style=display:flex><span>                    _logger.LogError(<span style=color:#e6db74>&#34;Memory store is null. Cannot load the knowledge base&#34;</span>);
</span></span><span style=display:flex><span>                }
</span></span><span style=display:flex><span>            }
</span></span><span style=display:flex><span>            <span style=color:#66d9ef>catch</span> (Exception ex)
</span></span><span style=display:flex><span>            {
</span></span><span style=display:flex><span>                _logger.LogError(<span style=color:#e6db74>$&#34;Error reading or loading data: {ex.Message}&#34;</span>);
</span></span><span style=display:flex><span>            }
</span></span><span style=display:flex><span>        }
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>private</span> ISemanticTextMemory? GetMemoryStore()
</span></span><span style=display:flex><span>        {
</span></span><span style=display:flex><span>            <span style=color:#66d9ef>if</span> (_options.Value.Qdrant <span style=color:#66d9ef>is</span> not <span style=color:#66d9ef>null</span>)
</span></span><span style=display:flex><span>            {
</span></span><span style=display:flex><span>                <span style=color:#66d9ef>return</span> <span style=color:#66d9ef>new</span> QdrantMemoryStore(
</span></span><span style=display:flex><span>                    _options.Value.Qdrant.Endpoint,
</span></span><span style=display:flex><span>                    _options.Value.Qdrant.VectorSize
</span></span><span style=display:flex><span>                );
</span></span><span style=display:flex><span>            }
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>            <span style=color:#66d9ef>return</span> <span style=color:#66d9ef>null</span>;
</span></span><span style=display:flex><span>        }
</span></span><span style=display:flex><span>    }
</span></span><span style=display:flex><span>}
</span></span></code></pre></div><ul><li>Add the corresponding SemanticKernelOptions class:</li></ul><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-csharp data-lang=csharp><span style=display:flex><span><span style=color:#66d9ef>using</span> System.ComponentModel.DataAnnotations;
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>namespace</span> MyRAGApp
</span></span><span style=display:flex><span>{
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>public</span> <span style=color:#66d9ef>class</span> <span style=color:#a6e22e>SemanticKernelOptions</span>
</span></span><span style=display:flex><span>    {
</span></span><span style=display:flex><span><span style=color:#a6e22e>        [Required]</span>
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>public</span> OpenAIConfig? OpenAI { <span style=color:#66d9ef>get</span>; <span style=color:#66d9ef>set</span>; }
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>public</span> QdrantConfig? Qdrant { <span style=color:#66d9ef>get</span>; <span style=color:#66d9ef>set</span>; }
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    }
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>public</span> <span style=color:#66d9ef>class</span> <span style=color:#a6e22e>OpenAIConfig</span>
</span></span><span style=display:flex><span>    {
</span></span><span style=display:flex><span><span style=color:#a6e22e>        [Required]</span>
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>public</span> <span style=color:#66d9ef>string?</span> ApiKey { <span style=color:#66d9ef>get</span>; <span style=color:#66d9ef>set</span>; }
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>public</span> <span style=color:#66d9ef>string?</span> OrgId { <span style=color:#66d9ef>get</span>; <span style=color:#66d9ef>set</span>; }
</span></span><span style=display:flex><span><span style=color:#a6e22e>
</span></span></span><span style=display:flex><span><span style=color:#a6e22e>        [Required]</span>
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>public</span> <span style=color:#66d9ef>string?</span> ModelId { <span style=color:#66d9ef>get</span>; <span style=color:#66d9ef>set</span>; }
</span></span><span style=display:flex><span><span style=color:#a6e22e>        [Required]</span>
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>public</span> <span style=color:#66d9ef>string?</span> EmbeddingModelId { <span style=color:#66d9ef>get</span>; <span style=color:#66d9ef>set</span>; }
</span></span><span style=display:flex><span>    }
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>public</span> <span style=color:#66d9ef>class</span> <span style=color:#a6e22e>QdrantConfig</span>
</span></span><span style=display:flex><span>    {
</span></span><span style=display:flex><span><span style=color:#a6e22e>        [Required]</span>
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>public</span> <span style=color:#66d9ef>string?</span> Endpoint { <span style=color:#66d9ef>get</span>; <span style=color:#66d9ef>set</span>; }
</span></span><span style=display:flex><span><span style=color:#a6e22e>        [Required]</span>
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>public</span> <span style=color:#66d9ef>int?</span> VectorSize { <span style=color:#66d9ef>get</span>; <span style=color:#66d9ef>set</span>; }
</span></span><span style=display:flex><span><span style=color:#a6e22e>        [Required]</span>
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>public</span> <span style=color:#66d9ef>string?</span> CollectionName { <span style=color:#66d9ef>get</span>; <span style=color:#66d9ef>set</span>; }
</span></span><span style=display:flex><span>    }
</span></span><span style=display:flex><span>}
</span></span></code></pre></div><ul><li>Make sure to add your knowledge base content in the <code>knowledge_base.txt</code> in the <code>wwwroot/</code> directory or other preferred location.</li></ul><p><strong>4. Kernel Setup</strong></p><ul><li><strong>Create a Kernel service (<code>Services/KernelService.cs</code>):</strong></li></ul><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-csharp data-lang=csharp><span style=display:flex><span><span style=color:#66d9ef>using</span> Microsoft.SemanticKernel;
</span></span><span style=display:flex><span><span style=color:#66d9ef>using</span> Microsoft.SemanticKernel.Connectors.OpenAI;
</span></span><span style=display:flex><span><span style=color:#66d9ef>using</span> Microsoft.Extensions.Options;
</span></span><span style=display:flex><span><span style=color:#66d9ef>using</span> Microsoft.SemanticKernel.Memory;
</span></span><span style=display:flex><span><span style=color:#66d9ef>using</span> Microsoft.SemanticKernel.Embeddings;
</span></span><span style=display:flex><span><span style=color:#66d9ef>using</span> Microsoft.SemanticKernel.Connectors.Memory.Qdrant;
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>namespace</span> MyRAGApp.Services
</span></span><span style=display:flex><span>{
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>public</span> <span style=color:#66d9ef>class</span> <span style=color:#a6e22e>KernelService</span>
</span></span><span style=display:flex><span>    {
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>private</span> <span style=color:#66d9ef>readonly</span> IOptions&lt;SemanticKernelOptions&gt; _options;
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>private</span> <span style=color:#66d9ef>readonly</span> ILogger&lt;KernelService&gt; _logger;
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>public</span> KernelService(IOptions&lt;SemanticKernelOptions&gt; options, ILogger&lt;KernelService&gt; logger)
</span></span><span style=display:flex><span>        {
</span></span><span style=display:flex><span>            _options = options;
</span></span><span style=display:flex><span>            _logger = logger;
</span></span><span style=display:flex><span>        }
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>public</span> IKernel GetKernel()
</span></span><span style=display:flex><span>        {
</span></span><span style=display:flex><span>            <span style=color:#66d9ef>try</span>
</span></span><span style=display:flex><span>            {
</span></span><span style=display:flex><span>                <span style=color:#66d9ef>var</span> builder = Kernel.Builder;
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>                <span style=color:#66d9ef>var</span> apiKey = _options.Value.OpenAI?.ApiKey;
</span></span><span style=display:flex><span>                <span style=color:#66d9ef>var</span> orgId = _options.Value.OpenAI?.OrgId;
</span></span><span style=display:flex><span>                <span style=color:#66d9ef>var</span> modelId = _options.Value.OpenAI?.ModelId;
</span></span><span style=display:flex><span>                <span style=color:#66d9ef>var</span> embeddingModelId = _options.Value.OpenAI?.EmbeddingModelId;
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>                <span style=color:#66d9ef>if</span> (<span style=color:#66d9ef>string</span>.IsNullOrEmpty(apiKey) || <span style=color:#66d9ef>string</span>.IsNullOrEmpty(modelId) || <span style=color:#66d9ef>string</span>.IsNullOrEmpty(embeddingModelId))
</span></span><span style=display:flex><span>                {
</span></span><span style=display:flex><span>                    _logger.LogError(<span style=color:#e6db74>&#34;OpenAI API settings are not correctly configured.&#34;</span>);
</span></span><span style=display:flex><span>                    <span style=color:#66d9ef>return</span> <span style=color:#66d9ef>null</span>;
</span></span><span style=display:flex><span>                }
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>                builder.AddAzureOpenAIChatCompletion(modelId, apiKey,orgId);
</span></span><span style=display:flex><span>                builder.AddAzureOpenAITextEmbeddingGeneration(embeddingModelId, apiKey, orgId);
</span></span><span style=display:flex><span>                builder.Services.AddTransient((sp) =&gt; GetMemoryStore());
</span></span><span style=display:flex><span>                <span style=color:#66d9ef>return</span> builder.Build();
</span></span><span style=display:flex><span>            }
</span></span><span style=display:flex><span>            <span style=color:#66d9ef>catch</span> (Exception ex)
</span></span><span style=display:flex><span>            {
</span></span><span style=display:flex><span>                _logger.LogError(<span style=color:#e6db74>$&#34;Error creating Kernel: {ex.Message}&#34;</span>);
</span></span><span style=display:flex><span>                <span style=color:#66d9ef>return</span> <span style=color:#66d9ef>null</span>;
</span></span><span style=display:flex><span>            }
</span></span><span style=display:flex><span>        }
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>private</span> ISemanticTextMemory? GetMemoryStore()
</span></span><span style=display:flex><span>        {
</span></span><span style=display:flex><span>            <span style=color:#66d9ef>if</span> (_options.Value.Qdrant <span style=color:#66d9ef>is</span> not <span style=color:#66d9ef>null</span>)
</span></span><span style=display:flex><span>            {
</span></span><span style=display:flex><span>                <span style=color:#66d9ef>return</span> <span style=color:#66d9ef>new</span> QdrantMemoryStore(
</span></span><span style=display:flex><span>                    _options.Value.Qdrant.Endpoint,
</span></span><span style=display:flex><span>                    _options.Value.Qdrant.VectorSize
</span></span><span style=display:flex><span>                );
</span></span><span style=display:flex><span>            }
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>            <span style=color:#66d9ef>return</span> <span style=color:#66d9ef>null</span>;
</span></span><span style=display:flex><span>        }
</span></span><span style=display:flex><span>    }
</span></span><span style=display:flex><span>}
</span></span></code></pre></div><p><strong>5. Register Services in <code>Program.cs</code></strong></p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-csharp data-lang=csharp><span style=display:flex><span><span style=color:#66d9ef>using</span> MyRAGApp;
</span></span><span style=display:flex><span><span style=color:#66d9ef>using</span> MyRAGApp.Services;
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>var</span> builder = WebApplication.CreateBuilder(args);
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>builder.Services.Configure&lt;SemanticKernelOptions&gt;(builder.Configuration.GetSection(<span style=color:#e6db74>&#34;SemanticKernel&#34;</span>));
</span></span><span style=display:flex><span><span style=color:#75715e>// Add services to the container.</span>
</span></span><span style=display:flex><span>builder.Services.AddRazorPages();
</span></span><span style=display:flex><span>builder.Services.AddServerSideBlazor();
</span></span><span style=display:flex><span>builder.Services.AddSingleton&lt;KernelService&gt;();
</span></span><span style=display:flex><span>builder.Services.AddSingleton&lt;DataLoader&gt;();
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>var</span> app = builder.Build();
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#75715e>// Configure the HTTP request pipeline.</span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>if</span> (!app.Environment.IsDevelopment())
</span></span><span style=display:flex><span>{
</span></span><span style=display:flex><span>    app.UseExceptionHandler(<span style=color:#e6db74>&#34;/Error&#34;</span>);
</span></span><span style=display:flex><span>    app.UseHsts();
</span></span><span style=display:flex><span>}
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>app.UseHttpsRedirection();
</span></span><span style=display:flex><span>app.UseStaticFiles();
</span></span><span style=display:flex><span>app.UseRouting();
</span></span><span style=display:flex><span>app.MapBlazorHub();
</span></span><span style=display:flex><span>app.MapFallbackToPage(<span style=color:#e6db74>&#34;/_Host&#34;</span>);
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>using</span> (<span style=color:#66d9ef>var</span> scope = app.Services.CreateScope())
</span></span><span style=display:flex><span>{
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>var</span> dataLoader = scope.ServiceProvider.GetRequiredService&lt;DataLoader&gt;();
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>var</span> kernelService = scope.ServiceProvider.GetRequiredService&lt;KernelService&gt;();
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>var</span> kernel = kernelService.GetKernel();
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>var</span> filePath = Path.Combine(app.Environment.WebRootPath, <span style=color:#e6db74>&#34;knowledge_base.txt&#34;</span>);
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>if</span> (kernel <span style=color:#66d9ef>is</span> not <span style=color:#66d9ef>null</span>)
</span></span><span style=display:flex><span>    {
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>await</span> dataLoader.LoadKnowledge(filePath, kernel);
</span></span><span style=display:flex><span>    }
</span></span><span style=display:flex><span>}
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>app.Run();
</span></span></code></pre></div><p><strong>6. Blazor UI</strong></p><ul><li><strong>Modify <code>Pages/Index.razor</code>:</strong></li></ul><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-csharp data-lang=csharp><span style=display:flex><span>@page <span style=color:#e6db74>&#34;/&#34;</span>
</span></span><span style=display:flex><span>@using MyRAGApp.Services
</span></span><span style=display:flex><span>@inject KernelService KernelService
</span></span><span style=display:flex><span>@inject ILogger&lt;Index&gt; Logger
</span></span><span style=display:flex><span>@inject DataLoader DataLoader
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>&lt;h1&gt;RAG with Semantic Kernel&lt;/h1&gt;
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>&lt;div class=<span style=color:#e6db74>&#34;input-group mb-3&#34;</span>&gt;
</span></span><span style=display:flex><span>    &lt;input type=<span style=color:#e6db74>&#34;text&#34;</span> class=<span style=color:#e6db74>&#34;form-control&#34;</span> placeholder=<span style=color:#e6db74>&#34;Ask a question&#34;</span> @bind=<span style=color:#e6db74>&#34;UserQuestion&#34;</span> /&gt;
</span></span><span style=display:flex><span>    &lt;button class=<span style=color:#e6db74>&#34;btn btn-primary&#34;</span> @onclick=<span style=color:#e6db74>&#34;AskQuestion&#34;</span>&gt;Ask&lt;/button&gt;
</span></span><span style=display:flex><span>&lt;/div&gt;
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>@if (!<span style=color:#66d9ef>string</span>.IsNullOrEmpty(Response))
</span></span><span style=display:flex><span>{
</span></span><span style=display:flex><span>    &lt;div class=<span style=color:#e6db74>&#34;alert alert-secondary&#34;</span>&gt;
</span></span><span style=display:flex><span>        @Response
</span></span><span style=display:flex><span>    &lt;/div&gt;
</span></span><span style=display:flex><span>}
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>@code {
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>private</span> <span style=color:#66d9ef>string</span> UserQuestion { <span style=color:#66d9ef>get</span>; <span style=color:#66d9ef>set</span>; } = <span style=color:#66d9ef>string</span>.Empty;
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>private</span> <span style=color:#66d9ef>string</span> Response { <span style=color:#66d9ef>get</span>; <span style=color:#66d9ef>set</span>; } = <span style=color:#66d9ef>string</span>.Empty;
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>private</span> <span style=color:#66d9ef>async</span> Task AskQuestion()
</span></span><span style=display:flex><span>    {
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>if</span> (<span style=color:#66d9ef>string</span>.IsNullOrEmpty(UserQuestion)) <span style=color:#66d9ef>return</span>;
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>         <span style=color:#66d9ef>var</span> kernel = KernelService.GetKernel();
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>if</span> (kernel <span style=color:#66d9ef>is</span> <span style=color:#66d9ef>null</span>)
</span></span><span style=display:flex><span>        {
</span></span><span style=display:flex><span>            Logger.LogError(<span style=color:#e6db74>&#34;Kernel was not properly initialized&#34;</span>);
</span></span><span style=display:flex><span>            Response = <span style=color:#e6db74>&#34;Error initializing the kernel.&#34;</span>;
</span></span><span style=display:flex><span>            <span style=color:#66d9ef>return</span>;
</span></span><span style=display:flex><span>        }
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>try</span>
</span></span><span style=display:flex><span>        {
</span></span><span style=display:flex><span>           <span style=color:#66d9ef>var</span> result = <span style=color:#66d9ef>await</span> kernel.Memory.SearchAsync(<span style=color:#e6db74>&#34;ragcollection&#34;</span>, UserQuestion, limit:<span style=color:#ae81ff>1</span>, minRelevanceScore:<span style=color:#ae81ff>0.7</span>);
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>             <span style=color:#66d9ef>var</span> context = result.FirstOrDefault()?.Text;
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>             <span style=color:#66d9ef>if</span>(context != <span style=color:#66d9ef>null</span>)
</span></span><span style=display:flex><span>            {
</span></span><span style=display:flex><span>                <span style=color:#66d9ef>var</span> prompt = <span style=color:#960050;background-color:#1e0010>@</span><span style=color:#e6db74>$&#34;You are an AI assistant. Use the provided context to answer the question. If the context is not relevant for the answer, say you don&#39;t know. 
</span></span></span><span style=display:flex><span><span style=color:#e6db74>
</span></span></span><span style=display:flex><span><span style=color:#e6db74>                    Context:
</span></span></span><span style=display:flex><span><span style=color:#e6db74>                    {context}
</span></span></span><span style=display:flex><span><span style=color:#e6db74>
</span></span></span><span style=display:flex><span><span style=color:#e6db74>                    Question: {UserQuestion}
</span></span></span><span style=display:flex><span><span style=color:#e6db74>                &#34;</span>;
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>                <span style=color:#66d9ef>var</span> promptTemplateFactory = <span style=color:#66d9ef>new</span> Microsoft.SemanticKernel.PromptTemplate.PromptTemplateFactory();
</span></span><span style=display:flex><span>                <span style=color:#66d9ef>var</span> promptTemplate = promptTemplateFactory.Create(prompt);
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>                <span style=color:#66d9ef>var</span> chatFunction = kernel.CreateSemanticFunction(promptTemplate);
</span></span><span style=display:flex><span>                <span style=color:#66d9ef>var</span> answer = <span style=color:#66d9ef>await</span> kernel.RunAsync(<span style=color:#66d9ef>new</span> KernelArguments(), chatFunction);
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>                Response = answer.ToString();
</span></span><span style=display:flex><span>            } <span style=color:#66d9ef>else</span>
</span></span><span style=display:flex><span>             {
</span></span><span style=display:flex><span>                Response = <span style=color:#e6db74>&#34;No relevant knowledge found. Please ask a question related to the content of knowledge base file&#34;</span>;
</span></span><span style=display:flex><span>             }
</span></span><span style=display:flex><span>            
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>        }
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>catch</span> (Exception ex)
</span></span><span style=display:flex><span>        {
</span></span><span style=display:flex><span>             Logger.LogError(<span style=color:#e6db74>$&#34;Error processing question: {ex.Message}&#34;</span>);
</span></span><span style=display:flex><span>             Response = <span style=color:#e6db74>$&#34;An error occurred: {ex.Message}&#34;</span>;
</span></span><span style=display:flex><span>        }
</span></span><span style=display:flex><span>    }
</span></span><span style=display:flex><span>}
</span></span></code></pre></div><p><strong>Explanation:</strong></p><ol><li><strong>Dependency Injection:</strong> We inject <code>KernelService</code> and <code>DataLoader</code> to use them in the page.</li><li><strong>UI Elements:</strong><ul><li>A text input (<code>UserQuestion</code>) for the user to type their question.</li><li>A button to trigger the question processing.</li><li>A div (<code>Response</code>) to display the result.</li></ul></li><li><strong><code>AskQuestion</code> Method:</strong><ul><li>Gets the kernel from the <code>KernelService</code>.</li><li>Uses Semantic Kernel&rsquo;s memory to search for relevant data.</li><li>Constructs an advanced prompt with retrieved context.</li><li>Uses Semantic Kernel to run an LLM completion and get the response.</li><li>Updates the <code>Response</code> variable, which triggers a UI update.</li></ul></li></ol><p><strong>How to Run</strong></p><ol><li>Make sure that your Qdrant instance is running.</li><li>Set your API keys in <code>appsettings.json</code>.</li><li>Add your knowledge base content in the <code>knowledge_base.txt</code> file.</li><li>Build and run your project (<code>dotnet run</code>).</li><li>Navigate to the application in your browser (<code>https://localhost:7085</code> by default).</li><li>Type your question in the input and hit &ldquo;Ask.&rdquo;</li></ol><p><strong>Important Considerations</strong></p><ul><li><strong>Error Handling:</strong> Implement better error handling and logging throughout your application.</li><li><strong>Memory Store Selection:</strong> Explore other vector databases or memory stores (like Azure Cognitive Search). <code>Qdrant</code> is a good starting point.</li><li><strong>Prompt Engineering:</strong> Fine-tune your prompts to get the best results.</li><li><strong>Performance:</strong> Vector search and LLM completions can be slow. Optimize based on your application&rsquo;s needs.</li><li><strong>Security:</strong> Be mindful of storing your API keys securely. Use environment variables or secrets management.</li></ul><p>Let me know if you would like to dive deeper into specific parts of this process, like more advanced prompt engineering or using a different memory store. I&rsquo;m here to help you get your RAG application working!</p></div><div class="post_extra mb-2"><div class=copy data-before="Share Story" data-after="Link Copied"><svg class="icon"><use xlink:href="#copy"/></svg></div></div><div></div></div></div><a href=https://ssathya.github.io/SridharBlog/ class=post_nav><span class=post_next>Latest Posts
<svg class="icon icon_scale"><use xlink:href="#double-arrow"/></svg></span></a></div></main><footer class="footer wrap pale"><p>&copy;&nbsp;<span class=year></span>&nbsp;Sridhar's Blog!</p><p class="attribution upcase">Designed by <a href='<no value>' target=_blank title='Linkedin Profile' rel=nonopener><no value></a></p></footer><script src=https://ssathya.github.io/SridharBlog/js/index.min.37437af50776941f9afce75ecfefd228d0ee6ceb0ad33ff35a9fea22b0a7236be8e38a9ff1666ad540d25dd37bc569705c5cceb13f7cd57ccbf3678201c43771.js></script><svg width="0" height="0" class="hidden"><symbol xmlns="http://www.w3.org/2000/svg" viewBox="0 0 699.428 699.428" id="copy"><path d="M502.714.0H240.428C194.178.0 153 42.425 153 87.429l-25.267.59c-46.228.0-84.019 41.834-84.019 86.838V612c0 45.004 41.179 87.428 87.429 87.428H459c46.249.0 87.428-42.424 87.428-87.428h21.857c46.25.0 87.429-42.424 87.429-87.428v-349.19L502.714.0zM459 655.715H131.143c-22.95.0-43.714-21.441-43.714-43.715V174.857c0-22.272 18.688-42.993 41.638-42.993l23.933-.721v393.429C153 569.576 194.178 612 240.428 612h262.286c0 22.273-20.765 43.715-43.714 43.715zm153-131.143c0 22.271-20.765 43.713-43.715 43.713H240.428c-22.95.0-43.714-21.441-43.714-43.713V87.429c0-22.272 20.764-43.714 43.714-43.714H459c-.351 50.337.0 87.975.0 87.975.0 45.419 40.872 86.882 87.428 86.882H612v306zm-65.572-349.715c-23.277.0-43.714-42.293-43.714-64.981V44.348L612 174.857h-65.572zm-43.714 131.537H306c-12.065.0-21.857 9.77-21.857 21.835s9.792 21.835 21.857 21.835h196.714c12.065.0 21.857-9.771 21.857-21.835.0-12.065-9.792-21.835-21.857-21.835zm0 109.176H306c-12.065.0-21.857 9.77-21.857 21.834.0 12.066 9.792 21.836 21.857 21.836h196.714c12.065.0 21.857-9.77 21.857-21.836.0-12.064-9.792-21.834-21.857-21.834z"/></symbol><symbol viewBox="0 0 53 42" xmlns="http://www.w3.org/2000/svg" id="double-arrow"><path d="M.595 39.653a1.318 1.318.0 010-1.864L16.55 21.833a1.318 1.318.0 000-1.863L.595 4.014a1.318 1.318.0 010-1.863L2.125.62a1.318 1.318.0 011.864.0l19.35 19.349a1.318 1.318.0 010 1.863l-19.35 19.35a1.318 1.318.0 01-1.863.0zm29 0a1.318 1.318.0 010-1.864L45.55 21.833a1.318 1.318.0 000-1.863L29.595 4.014a1.318 1.318.0 010-1.863l1.53-1.53a1.318 1.318.0 011.864.0l19.35 19.349a1.318 1.318.0 010 1.863l-19.35 19.35a1.318 1.318.0 01-1.863.0z"/></symbol></svg></body></html>