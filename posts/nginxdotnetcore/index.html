<!doctype html><html lang=en><head><title>Nginx dot net core | Sridhar's Blog!</title><meta charset=utf-8><meta name=viewport content="width=device-width,initial-scale=1,maximum-scale=1,user-scalable=no"><meta http-equiv=X-UA-Compatible content="IE=edge"><meta name=keywords content="Sridhar's Blog!"><meta property="og:locale" content='en_US'><meta property="og:type" content="article"><meta property="og:title" content="NginxDotNetCore"><meta property="og:description" content="How was Stock filter installed?
Introduction
Stockfilter is a Dot Net application that uses the inbuilt webserver Kestrel to host the application. Kestrel is a"><meta property="og:url" content="https://ssathya.github.io/SridharBlog/posts/nginxdotnetcore/"><meta property="og:image" content="images/%!s(<nil>)"><link rel=canonical href=https://ssathya.github.io/SridharBlog/posts/nginxdotnetcore/><link rel=apple-touch-icon sizes=180x180 href=https://ssathya.github.io/SridharBlog/apple-touch-icon.png><link rel=icon type=image/png sizes=32x32 href=https://ssathya.github.io/SridharBlog/favicon-32x32.png><link rel=icon type=image/png sizes=16x16 href=https://ssathya.github.io/SridharBlog/favicon-16x16.png><link rel=manifest href=https://ssathya.github.io/SridharBlog/site.webmanifest><link rel=stylesheet href=https://ssathya.github.io/SridharBlog/css/styles.648e60c6d86809f863ae1346848574b9c685732794e7851c7d3e557de9ddd293bc1c209f963d5041785c2fd4268470bdfde453a99f550b655d1b4f825eed4682.css integrity="sha512-ZI5gxthoCfhjrhNGhIV0ucaFcyeU54UcfT5Vfend0pO8HCCflj1QQXhcL9QmhHC9/eRTqZ9VC2VdG0+CXu1Ggg=="></head><body><div class=nav-drop><div class=nav-body><div class=nav-close></div><div class=color_mode><label for=mode>Toggle Dark Mode</label>
<input type=checkbox class=color_choice id=mode></div></div></div><header class=nav><nav class=nav-menu><a href=https://ssathya.github.io/SridharBlog/ class="nav-brand nav_item">Sridhar's Blog!</a><div class=nav_bar-wrap><div class=nav_bar></div></div></nav></header><main><div class="wrap mt post"><div><p class=post_date>01. September 2025</p><h1 class=post_title>NginxDotNetCore</h1><div class=post_body><div class=post_inner><h2 id=how-was-stock-filter-installed>How was Stock filter installed?</h2><h1 id=introduction>Introduction</h1><p>Stockfilter is a Dot Net application that uses the inbuilt webserver Kestrel to host the application. Kestrel is a light weight web server for hosting ASP.NET Core applications on really any platform. Kestrel lacks a lot of the things that an ASP.NET web developer might have come to expect from a web server like IIS. For instance you cannot do SSL termination with Kestrel or URL rewrites or GZip compression.</p><p>Nginix is a full-fledged web server. You can use it as a reverse proxy; in this configuration it takes load off your actual web server by preserving a cache of data which it serves before calling back to your web server. As a proxy it can also sit in front of multiple end points on your server and make them appear to be a single end point. This is useful for hiding a number of microservices behind a single end point. It can do SSL termination which makes it easy to add SSL to your site without having to modify a single line of code.</p><p>This document was prepared using the procedures mentioned in <a href="https://docs.microsoft.com/en-us/aspnet/core/fundamentals/servers/kestrel?view=aspnetcore-6.0">Microsoft docs</a> and following a <a href="https://www.youtube.com/watch?v=mkBYgwfOzdc">YouTube</a> by Ayden’s Developer Channel.</p><h1 id=register-your-domain>Register your domain</h1><p>For this application I used <a href=https://domains.google/>Google domain</a> to register the domain name <a href=https://stockfilter.de/>Stock Filter</a>.</p><h2 id=dns-resolve>DNS Resolve</h2><p>Click on the name of the new domain you created in Google Domain and on the left menu click on DNS. Select <em>Default name servers</em> and <em>Manage custom records.</em> Here we are going to create an <em>A Record</em> and a <em>CNAME Record</em>. (A record is domain name to IP address mapping and CNAME points to another name <em>usually the value on A record</em>).</p><h2 id=install-required-software>Install required software</h2><p>This is simple; we are going to issue the following commands.</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-sh data-lang=sh><span style=display:flex><span>sudo apt install nginx
</span></span><span style=display:flex><span>sudo apt install certbot
</span></span><span style=display:flex><span>sudo apt install python3-certbot-nginx
</span></span></code></pre></div><p>Lets assume you worked on the CNAME and A Record(s); if not take a walk. This might be good time to ensure your installation is working fine until now. You should be greeted with the default Nginx web page and if you get see any errors then <strong>Stackoverflow</strong>!</p><h2 id=build-your-application>Build your application</h2><p>By now you should have your application fully tested and ready for deployment. Build your application with the command</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-sh data-lang=sh><span style=display:flex><span>dotnet publish -c Release 
</span></span></code></pre></div><p>Once successfully built the executables will be in</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-sh data-lang=sh><span style=display:flex><span>........./bin/Release/netX.X/
</span></span></code></pre></div><p>folder. We want this application to start on startup as a service and the best way to start the application and restart it if needed will be to run it as a Daemon application. To do that we will create a file in</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-sh data-lang=sh><span style=display:flex><span>/etc/systemd/system/
</span></span></code></pre></div><p>folder. Though you can create the file with any name I like the naming convention</p><pre tabindex=0><code>ApplicationName.service
</code></pre><p>The content of this file will be as follows (adjust it as per your needs)</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-sh data-lang=sh><span style=display:flex><span><span style=color:#f92672>[</span>Unit<span style=color:#f92672>]</span>
</span></span><span style=display:flex><span>Description<span style=color:#f92672>=</span> StockSelector
</span></span><span style=display:flex><span><span style=color:#f92672>[</span>Service<span style=color:#f92672>]</span>
</span></span><span style=display:flex><span>User<span style=color:#f92672>=</span>srvean
</span></span><span style=display:flex><span>Group<span style=color:#f92672>=</span>srvean
</span></span><span style=display:flex><span>WorkingDirectory<span style=color:#f92672>=</span>/home/srvean/DotNet/Stock-Selector-UI/StockSelector/Server/
</span></span><span style=display:flex><span>ExecStart<span style=color:#f92672>=</span>/usr/bin/dotnet run --configuration Release
</span></span><span style=display:flex><span>Restart<span style=color:#f92672>=</span>always
</span></span><span style=display:flex><span><span style=color:#75715e># Restart service after 60 seconds if the dotnet service crashes:</span>
</span></span><span style=display:flex><span>RestartSec<span style=color:#f92672>=</span><span style=color:#ae81ff>60</span>
</span></span><span style=display:flex><span>SyslogIdentifier<span style=color:#f92672>=</span>StockSelector
</span></span><span style=display:flex><span>Environment<span style=color:#f92672>=</span>ASPNETCORE_ENVIRONMENT<span style=color:#f92672>=</span>Production
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#f92672>[</span>Install<span style=color:#f92672>]</span>
</span></span><span style=display:flex><span>WantedBy<span style=color:#f92672>=</span>multi-user.target                    
</span></span></code></pre></div><p>Most of the values above should be self-explanatory. The working directory could have been the <em>bin/Release/netx/</em> folder but didn&rsquo;t try <strong>dotnet run xxxx.dll</strong> command. Going forward we&rsquo;ll assume that the application <strong>listens on port 5000 for HTTP</strong> requests. Now let us enable the server and run it:</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-sh data-lang=sh><span style=display:flex><span>sudo systemctl enable ApplicationName.service
</span></span><span style=display:flex><span>sudo systemctl restart ApplicationName.service
</span></span><span style=display:flex><span>sudo systemctl status ApplicationName.service
</span></span></code></pre></div><p>Well, you know what we are doing above.</p><h2 id=configure-nginx>Configure Nginx</h2><p>To configure Nginx as a reverse proxy to forward HTTP requests to your ASP.NET Core app, modify <code>/etc/nginx/sites-available/default</code>. Open it in a text editor, <strong>and replace the contents with the following snippet</strong>:</p><pre tabindex=0><code>server {
    listen        80;
    server_name   stockfilter.de;
    location / {
        proxy_pass         http://127.0.0.1:5000;
        proxy_http_version 1.1;
        proxy_set_header   Upgrade $http_upgrade;
        proxy_set_header   Connection keep-alive;
        proxy_set_header   Host $host;
        proxy_cache_bypass $http_upgrade;
        proxy_set_header   X-Forwarded-For $proxy_add_x_forwarded_for;
        proxy_set_header   X-Forwarded-Proto $scheme;
    }
}
</code></pre><p>You can use the above code as is; only change the value for <em>server_name</em>. After updating the file you can run the command:</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-sh data-lang=sh><span style=display:flex><span>sudo nginx -t
</span></span></code></pre></div><p>to test if the configuration is free of manual errors. Now let us restart the server with command</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-sh data-lang=sh><span style=display:flex><span>sudo systemctl restart nginx
</span></span></code></pre></div><p>Now if you navigate to your site (http not <del>https</del>) your Dot Net application should be running. If you do not get the expected results => <strong>Stackoverflow</strong>!</p><h2 id=securing-our-site>Securing our site.</h2><p>To automate the process of obtaining, installing, and updating TLS/SSL certificates on a web server, <a href=https://letsencrypt.org/>Let’s Encrypt</a> is an extremely useful tool. It is a certificate authority (CA) that comes packaged with a corresponding software client, Certbot, that will automatically install TLS/SSL certificates. This means that we can run encrypted HTTPS on a web server without having to worry about constant maintenance.</p><p>We&rsquo;ll relate Certbot and our instance of Nginx using the following command:</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-sh data-lang=sh><span style=display:flex><span>sudo certbot --nginx -d stockfilter.de
</span></span></code></pre></div><p>Obviously, the value for -d in the above command will be for our domain name. Certbot will ask a few straightforward questions which need to be answered.</p><h3 id=proxy>Proxy</h3><p>Add the <em>/etc/nginx/proxy.conf</em> configuration file:</p><pre tabindex=0><code>proxy_redirect          off;
proxy_set_header        Host $host;
proxy_set_header        X-Real-IP $remote_addr;
proxy_set_header        X-Forwarded-For $proxy_add_x_forwarded_for;
proxy_set_header        X-Forwarded-Proto $scheme;
client_max_body_size    10m;
client_body_buffer_size 128k;
proxy_connect_timeout   90;
proxy_send_timeout      90;
proxy_read_timeout      90;
proxy_buffers           32 4k;
</code></pre><p><strong>Replace</strong> the contents of the <em>/etc/nginx/nginx.conf</em> configuration file with the following file. The example contains both <code>http</code> and <code>server</code> sections in one configuration file.</p><pre tabindex=0><code>http {
    include        /etc/nginx/proxy.conf;
    limit_req_zone $binary_remote_addr zone=one:10m rate=5r/s;
    server_tokens  off;

    sendfile on;
    # Adjust keepalive_timeout to the lowest possible value that makes sense 
    # for your use case.
    keepalive_timeout   29;
    client_body_timeout 10; client_header_timeout 10; send_timeout 10;

    upstream helloapp{
        server 127.0.0.1:5000;
    }

    server {
        listen                    443 ssl http2;
        listen                    [::]:443 ssl http2;
        server_name               example.com *.example.com;
        ssl_certificate           /etc/ssl/certs/testCert.crt;
        ssl_certificate_key       /etc/ssl/certs/testCert.key;
        ssl_session_timeout       1d;
        ssl_protocols             TLSv1.2 TLSv1.3;
        ssl_prefer_server_ciphers off;
        ssl_ciphers               ECDHE-ECDSA-AES128-GCM-SHA256:ECDHE-RSA-AES128-GCM-SHA256:ECDHE-ECDSA-AES256-GCM-SHA384:ECDHE-RSA-AES256-GCM-SHA384:ECDHE-ECDSA-CHACHA20-POLY1305:ECDHE-RSA-CHACHA20-POLY1305:DHE-RSA-AES128-GCM-SHA256:DHE-RSA-AES256-GCM-SHA384;
        ssl_session_cache         shared:SSL:10m;
        ssl_session_tickets       off;
        ssl_stapling              off;

        add_header X-Frame-Options DENY;
        add_header X-Content-Type-Options nosniff;

        #Redirects all traffic
        location / {
            proxy_pass http://helloapp;
            limit_req  zone=one burst=10 nodelay;
        }
    }
}
</code></pre><p>In the above file you need to update <strong>ssl_certificate</strong> and <strong>ssl_certificate_key</strong>. We can get its values from <em>/etc/nginx/sites-available/default</em> file that we updated earlier. After we updated when we ran Certbot it would have added a few lines after our edit and in the inserts that Certbot inserted you would see entries for <strong>ssl_certificate</strong> and <strong>ssl_certificate_key</strong>. Copy those values and replace it in the above code. Also replace <em>example.com</em> in the above code to your domain (e.g. stockfilter.de).</p><h2 id=almost-done>Almost done</h2><p>Let&rsquo;s make sure our configuration changes are good by issuing the command</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-sh data-lang=sh><span style=display:flex><span>sudo nginx -t
</span></span></code></pre></div><p>And if nginx states you&rsquo;ve done an excellent job then let us restart the server by issuing the command</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-sh data-lang=sh><span style=display:flex><span>sudo systemctl restart nginx
</span></span></code></pre></div><p>Navigate to your site using the https link (e.g. <a href=https://stockfilter.de>https://stockfilter.de</a>) and if things are good then its time for your coffee break :coffee:.</p><p>Else <strong>Stackoverflow</strong>! :anguished:</p></div><div class="post_extra mb-2"><div class=copy data-before="Share Story" data-after="Link Copied"><svg class="icon"><use xlink:href="#copy"/></svg></div></div><div></div></div></div><a href=https://ssathya.github.io/SridharBlog/ class=post_nav><span class=post_next>Latest Posts
<svg class="icon icon_scale"><use xlink:href="#double-arrow"/></svg></span></a></div></main><footer class="footer wrap pale"><p>&copy;&nbsp;<span class=year></span>&nbsp;Sridhar's Blog!</p><p class="attribution upcase">Designed by <a href='<no value>' target=_blank title='Linkedin Profile' rel=nonopener><no value></a></p></footer><script src=https://ssathya.github.io/SridharBlog/js/index.min.37437af50776941f9afce75ecfefd228d0ee6ceb0ad33ff35a9fea22b0a7236be8e38a9ff1666ad540d25dd37bc569705c5cceb13f7cd57ccbf3678201c43771.js></script><svg width="0" height="0" class="hidden"><symbol xmlns="http://www.w3.org/2000/svg" viewBox="0 0 699.428 699.428" id="copy"><path d="M502.714.0H240.428C194.178.0 153 42.425 153 87.429l-25.267.59c-46.228.0-84.019 41.834-84.019 86.838V612c0 45.004 41.179 87.428 87.429 87.428H459c46.249.0 87.428-42.424 87.428-87.428h21.857c46.25.0 87.429-42.424 87.429-87.428v-349.19L502.714.0zM459 655.715H131.143c-22.95.0-43.714-21.441-43.714-43.715V174.857c0-22.272 18.688-42.993 41.638-42.993l23.933-.721v393.429C153 569.576 194.178 612 240.428 612h262.286c0 22.273-20.765 43.715-43.714 43.715zm153-131.143c0 22.271-20.765 43.713-43.715 43.713H240.428c-22.95.0-43.714-21.441-43.714-43.713V87.429c0-22.272 20.764-43.714 43.714-43.714H459c-.351 50.337.0 87.975.0 87.975.0 45.419 40.872 86.882 87.428 86.882H612v306zm-65.572-349.715c-23.277.0-43.714-42.293-43.714-64.981V44.348L612 174.857h-65.572zm-43.714 131.537H306c-12.065.0-21.857 9.77-21.857 21.835s9.792 21.835 21.857 21.835h196.714c12.065.0 21.857-9.771 21.857-21.835.0-12.065-9.792-21.835-21.857-21.835zm0 109.176H306c-12.065.0-21.857 9.77-21.857 21.834.0 12.066 9.792 21.836 21.857 21.836h196.714c12.065.0 21.857-9.77 21.857-21.836.0-12.064-9.792-21.834-21.857-21.834z"/></symbol><symbol viewBox="0 0 53 42" xmlns="http://www.w3.org/2000/svg" id="double-arrow"><path d="M.595 39.653a1.318 1.318.0 010-1.864L16.55 21.833a1.318 1.318.0 000-1.863L.595 4.014a1.318 1.318.0 010-1.863L2.125.62a1.318 1.318.0 011.864.0l19.35 19.349a1.318 1.318.0 010 1.863l-19.35 19.35a1.318 1.318.0 01-1.863.0zm29 0a1.318 1.318.0 010-1.864L45.55 21.833a1.318 1.318.0 000-1.863L29.595 4.014a1.318 1.318.0 010-1.863l1.53-1.53a1.318 1.318.0 011.864.0l19.35 19.349a1.318 1.318.0 010 1.863l-19.35 19.35a1.318 1.318.0 01-1.863.0z"/></symbol></svg></body></html>