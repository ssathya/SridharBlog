<!doctype html><html lang=en><head><title>Installing open VPN in an vm | Sridhar's Blog!</title><meta charset=utf-8><meta name=viewport content="width=device-width,initial-scale=1,maximum-scale=1,user-scalable=no"><meta http-equiv=X-UA-Compatible content="IE=edge"><meta name=keywords content="Sridhar's Blog!"><meta property="og:locale" content='en_US'><meta property="og:type" content="article"><meta property="og:title" content="Installing open VPN in an VM"><meta property="og:description" content="The following instructions are based on this Youtube video
Introduction
When I want to virtually travel to a different country I need to create a VPN server in"><meta property="og:url" content="https://ssathya.github.io/SridharBlog/posts/openvpndockerubuntu/"><meta property="og:image" content="images/%!s(<nil>)"><link rel=canonical href=https://ssathya.github.io/SridharBlog/posts/openvpndockerubuntu/><link rel=apple-touch-icon sizes=180x180 href=https://ssathya.github.io/SridharBlog/apple-touch-icon.png><link rel=icon type=image/png sizes=32x32 href=https://ssathya.github.io/SridharBlog/favicon-32x32.png><link rel=icon type=image/png sizes=16x16 href=https://ssathya.github.io/SridharBlog/favicon-16x16.png><link rel=manifest href=https://ssathya.github.io/SridharBlog/site.webmanifest><link rel=stylesheet href=https://ssathya.github.io/SridharBlog/css/styles.648e60c6d86809f863ae1346848574b9c685732794e7851c7d3e557de9ddd293bc1c209f963d5041785c2fd4268470bdfde453a99f550b655d1b4f825eed4682.css integrity="sha512-ZI5gxthoCfhjrhNGhIV0ucaFcyeU54UcfT5Vfend0pO8HCCflj1QQXhcL9QmhHC9/eRTqZ9VC2VdG0+CXu1Ggg=="></head><body><div class=nav-drop><div class=nav-body><div class=nav-close></div><div class=color_mode><label for=mode>Toggle Dark Mode</label>
<input type=checkbox class=color_choice id=mode></div></div></div><header class=nav><nav class=nav-menu><a href=https://ssathya.github.io/SridharBlog/ class="nav-brand nav_item">Sridhar's Blog!</a><div class=nav_bar-wrap><div class=nav_bar></div></div></nav></header><main><div class="wrap mt post"><div><p class=post_date>15. March 2025</p><h1 class=post_title>Installing open VPN in an VM</h1><div class=post_body><div class=post_inner><p>The following instructions are based on this <a href="https://www.youtube.com/watch?v=vU0jyDGGUUE">Youtube video</a></p><h2 id=introduction>Introduction</h2><p>When I want to virtually travel to a different country I need to create a VPN server in that region and I often land up watching Youtube videos or installing the software wrong. So Iâ€™m creating this gist so that I will not be lost when I install my next OpenVPN server on a VM.</p><h2 id=platform>Platform</h2><p>Though we can use any VM, I prefer using LightSail offering from AWS to running my OpenVPN. Necessary changes need to be done (only in IP Firewall settings) based on the selected platform. I usually select the smallest server, (512 MB RAM, 1 vCPU, 20 GB SSD) to run my OpenVPN as it is going to <strong>serve only one client <em>me</em></strong>.</p><h2 id=prepare-the-server>Prepare the server</h2><p>The first change I do on any server is to edit the <em>.bashrc</em> file. I had the following two lines at the bottom of the file</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-sh data-lang=sh><span style=display:flex><span>PATH<span style=color:#f92672>=</span>./:~/bin/:$PATH
</span></span><span style=display:flex><span>set -o vi
</span></span></code></pre></div><p>Log out and log in to the server to load the changes to the environment.</p><h3 id=system-update>System Update</h3><p>Let us bring the latest updates to the operating system; I, almost always, use Ubuntu and I run the following commands:</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-sh data-lang=sh><span style=display:flex><span>sudo apt update <span style=color:#f92672>&amp;&amp;</span> sudo apt upgrade -y
</span></span><span style=display:flex><span>sudo reboot now
</span></span></code></pre></div><p>Of course, Ubuntu will ask you a couple of questions during the update and reboot requests; answer accordingly.
Once the server reboots:</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-sh data-lang=sh><span style=display:flex><span>sudo <span style=color:#66d9ef>do</span>-release-upgrade
</span></span><span style=display:flex><span>sudo reboot now
</span></span></code></pre></div><p>As usual, the OS will ask for your confirmations every now and then; answer them to ensure the installation completes.
<em>It depends on the server location and available resources but until now you should have spent around 30 to 45 minutes bringing up the server!</em></p><h3 id=start-installing-packages>Start installing packages</h3><p>It&rsquo;s time to install the necessary packages; I like to use <em>nala</em> instead of <em>apt</em> so I start with installing <strong>nala</strong>.</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-sh data-lang=sh><span style=display:flex><span>sudo apt install nala
</span></span></code></pre></div><p>Next, let us install docker:</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-sh data-lang=sh><span style=display:flex><span>nala install docker.io
</span></span></code></pre></div><p>After installing docker the system might request you reboot but let us issue one more command and then reboot the server; we&rsquo;ll add the current user to the user group docker and then reboot the server.</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-sh data-lang=sh><span style=display:flex><span>sudo usermod -aG docker $USER
</span></span><span style=display:flex><span>sudo reboot now
</span></span></code></pre></div><p>While the server is rebooting we need to open port 1194 so that your PC can communicate with the VPN server. Select your server in the Lightsail console as shown in the following image. In the following image, the name of my Server is OpenVPN and I&rsquo;ll click on it.
<img src=https://i.imgur.com/ReVi1qa.png alt="Select server first"></p><p>You will be presented with your server&rsquo;s console and on this screen click on the Network menu item:
<img src=https://i.imgur.com/aPFuTCe.png alt="Now select Networking menu item">
Update firewall rules so that we can use port 1194 using UDP protocol. In the image below I&rsquo;m opening ports 1190 to 1199 (don&rsquo;t ask me why; not necessary but I like to do it this way).
<img src=https://i.imgur.com/Q3URhGh.png alt="Update firewall to allow port 1190 to 1199"></p><p>Once you&rsquo;ve installed docker, let us use a different docker image, which automates most of the manual work mentioned above. Install the <strong>alekslitvinenk/openvpn</strong> as follows:</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-sh data-lang=sh><span style=display:flex><span>docker run -itd --rm --cap-add<span style=color:#f92672>=</span>NET_ADMIN <span style=color:#ae81ff>\
</span></span></span><span style=display:flex><span><span style=color:#ae81ff></span>-p 1194:1194/udp -p 80:8080/tcp <span style=color:#ae81ff>\
</span></span></span><span style=display:flex><span><span style=color:#ae81ff></span>-e HOST_ADDR<span style=color:#f92672>=</span><span style=color:#66d9ef>$(</span>curl -s https://api.ipify.org<span style=color:#66d9ef>)</span> <span style=color:#ae81ff>\
</span></span></span><span style=display:flex><span><span style=color:#ae81ff></span>--name dockovpn alekslitvinenk/openvpn
</span></span></code></pre></div><p>Make sure the VM has port 80 open for HTTP (default on with LightSail) and 1194 (details above) open. On your laptop/desktop, navigate to http://<em>Your servers IP address</em>, and your client profile will be downloaded to your local machine (the <em>ovpn</em> file). Use the profile to connect to your VPN server as mentioned above.</p><h3 id=security>Security</h3><p>Anyone accessing your IP address can download the ovpn file and use your VPN server. So, for security, it would be better to shut down the server or block port 80 when not in use.</p><h2 id=legacy-write-up>Legacy write-up</h2><h3 id=install-openvpn-and-configure-it>Install OpenVPN and configure it</h3><p>Your server should have rebooted by now; if not time for a coffee break. Okay, let&rsquo;s roll up our sleeves!</p><p>Hold on! Not so fast. Let&rsquo;s confirm we are ready.</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-sh data-lang=sh><span style=display:flex><span>docker run hello-world
</span></span></code></pre></div><p>Make sure we get no errors and now let us prepare to use openVPN.</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-sh data-lang=sh><span style=display:flex><span>docker pull kylemanna/openvpn
</span></span></code></pre></div><p>This should pull the necessary image to run openvpn.
Make a note of the servers&rsquo; public IP. We&rsquo;ll be using it in one of the following commands.
To keep all VPN content in one folder create a folder, say openVPN, and cd to that folder: now let&rsquo;s run the following commands:</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-sh data-lang=sh><span style=display:flex><span><span style=color:#75715e># Create and initialize openvpn</span>
</span></span><span style=display:flex><span>docker run --rm -v $PWD:/etc/openvpn kylemanna/openvpn ovpn_genconfig -u udp://&lt;YOUR PUBLIC IP&gt;
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#75715e># Create certificate</span>
</span></span><span style=display:flex><span>docker run --rm -v $PWD:/etc/openvpn -it kylemanna/openvpn ovpn_initpki
</span></span><span style=display:flex><span><span style=color:#75715e># it might ask you to provide phrases to encrypt the key; use a strong key and save it; you&#39;ll need it later.</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#75715e># Create a client account</span>
</span></span><span style=display:flex><span>docker run --rm -v $PWD:/etc/openvpn -it kylemanna/openvpn easyrsa build-client-full &lt;User ID&gt;
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#75715e># Copy client certificate (ovpn file) from container</span>
</span></span><span style=display:flex><span>docker run --rm -v $PWD:/etc/openvpn kylemanna/openvpn ovpn_getclient &lt;User ID&gt; &gt; &lt;User ID&gt;.ovpn
</span></span></code></pre></div><p>At this stage, we should have a file <user id>.ovpn in the openVPN folder. Transfer this file to your client&rsquo;s machine.
Finally, start the Open VPN server:</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-sh data-lang=sh><span style=display:flex><span>docker run --name openvpn -v $PWD:/etc/openvpn -d -p 1194:1194/udp --cap-add<span style=color:#f92672>=</span>NET_ADMIN --restart always kylemanna/openvpn
</span></span><span style=display:flex><span><span style=color:#75715e># Verify it is running</span>
</span></span><span style=display:flex><span>docker ps
</span></span></code></pre></div><p>All done; check if you can use the VPN server!</p></div><div class="post_extra mb-2"><div class=copy data-before="Share Story" data-after="Link Copied"><svg class="icon"><use xlink:href="#copy"/></svg></div></div><div></div></div></div><a href=https://ssathya.github.io/SridharBlog/ class=post_nav><span class=post_next>Latest Posts
<svg class="icon icon_scale"><use xlink:href="#double-arrow"/></svg></span></a></div></main><footer class="footer wrap pale"><p>&copy;&nbsp;<span class=year></span>&nbsp;Sridhar's Blog!</p><p class="attribution upcase">Designed by <a href='<no value>' target=_blank title='Linkedin Profile' rel=nonopener><no value></a></p></footer><script src=https://ssathya.github.io/SridharBlog/js/index.min.37437af50776941f9afce75ecfefd228d0ee6ceb0ad33ff35a9fea22b0a7236be8e38a9ff1666ad540d25dd37bc569705c5cceb13f7cd57ccbf3678201c43771.js></script><svg width="0" height="0" class="hidden"><symbol xmlns="http://www.w3.org/2000/svg" viewBox="0 0 699.428 699.428" id="copy"><path d="M502.714.0H240.428C194.178.0 153 42.425 153 87.429l-25.267.59c-46.228.0-84.019 41.834-84.019 86.838V612c0 45.004 41.179 87.428 87.429 87.428H459c46.249.0 87.428-42.424 87.428-87.428h21.857c46.25.0 87.429-42.424 87.429-87.428v-349.19L502.714.0zM459 655.715H131.143c-22.95.0-43.714-21.441-43.714-43.715V174.857c0-22.272 18.688-42.993 41.638-42.993l23.933-.721v393.429C153 569.576 194.178 612 240.428 612h262.286c0 22.273-20.765 43.715-43.714 43.715zm153-131.143c0 22.271-20.765 43.713-43.715 43.713H240.428c-22.95.0-43.714-21.441-43.714-43.713V87.429c0-22.272 20.764-43.714 43.714-43.714H459c-.351 50.337.0 87.975.0 87.975.0 45.419 40.872 86.882 87.428 86.882H612v306zm-65.572-349.715c-23.277.0-43.714-42.293-43.714-64.981V44.348L612 174.857h-65.572zm-43.714 131.537H306c-12.065.0-21.857 9.77-21.857 21.835s9.792 21.835 21.857 21.835h196.714c12.065.0 21.857-9.771 21.857-21.835.0-12.065-9.792-21.835-21.857-21.835zm0 109.176H306c-12.065.0-21.857 9.77-21.857 21.834.0 12.066 9.792 21.836 21.857 21.836h196.714c12.065.0 21.857-9.77 21.857-21.836.0-12.064-9.792-21.834-21.857-21.834z"/></symbol><symbol viewBox="0 0 53 42" xmlns="http://www.w3.org/2000/svg" id="double-arrow"><path d="M.595 39.653a1.318 1.318.0 010-1.864L16.55 21.833a1.318 1.318.0 000-1.863L.595 4.014a1.318 1.318.0 010-1.863L2.125.62a1.318 1.318.0 011.864.0l19.35 19.349a1.318 1.318.0 010 1.863l-19.35 19.35a1.318 1.318.0 01-1.863.0zm29 0a1.318 1.318.0 010-1.864L45.55 21.833a1.318 1.318.0 000-1.863L29.595 4.014a1.318 1.318.0 010-1.863l1.53-1.53a1.318 1.318.0 011.864.0l19.35 19.349a1.318 1.318.0 010 1.863l-19.35 19.35a1.318 1.318.0 01-1.863.0z"/></symbol></svg></body></html>